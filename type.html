<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Flappy Bet</title> 
  <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; flex-direction: column; align-items: center; background-color: skyblue; font-family: Arial, sans-serif; }
        #balance { font-size: 24px; font-weight: bold; margin: 10px; }
        #currentEarnings { font-size: 22px; font-weight: bold; color: darkgreen; margin-bottom: 10px; }
        .bet-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
        .bet-buttons button { padding: 10px 15px; font-size: 18px; cursor: pointer; border: none; border-radius: 5px; background-color: white; }
        .bet-buttons button.active { background-color: gold; }
        #playBtn { padding: 10px 20px; font-size: 20px; margin-bottom: 10px; background-color: green; color: white; border: none; cursor: pointer; }
        canvas { background-color: lightgreen; border: 2px solid black; }
        #playAgain { display: none; margin-top: 20px; padding: 10px 20px; font-size: 18px; cursor: pointer; border: none; background-color: red; color: white; border-radius: 5px; }
    </style> 
 </head> 
 <body> 
  <div id="balance">
   Total Balance: ₹ <span id="balanceAmount">1000</span>
  </div> 
  <div id="currentEarnings">
   ₹ 0
  </div> 
  <div class="bet-buttons"> <button data-bet="10">₹10</button> <button data-bet="30">₹30</button> <button data-bet="50">₹50</button> <button data-bet="100">₹100</button> <button data-bet="1000">₹1000</button> 
  </div> <button id="playBtn" disabled>Play</button> 
  <canvas id="gameCanvas" width="400" height="500"></canvas> <button id="playAgain">Play Again</button> 
  <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const playAgainBtn = document.getElementById("playAgain");
        const playBtn = document.getElementById("playBtn");
        const balanceAmount = document.getElementById("balanceAmount");
        const earningsDisplay = document.getElementById("currentEarnings");
        const betButtons = document.querySelectorAll(".bet-buttons button");

        let bird, pipes, score, gameRunning, selectedBet = 0;
        let passedPipes = 0, earnings = 0;

        // لوکل اسٹوریج میں بیلنس چیک کرو
        let balance = localStorage.getItem("balance") ? parseInt(localStorage.getItem("balance")) : 1000;
        balanceAmount.textContent = balance;

        // بیٹنگ بٹن ہینڈلنگ
        betButtons.forEach(button => {
            button.addEventListener("click", () => {
                betButtons.forEach(btn => btn.classList.remove("active"));
                button.classList.add("active");
                selectedBet = parseInt(button.dataset.bet);
                playBtn.disabled = false;
            });
        });

        function initGame() {
            if (selectedBet > balance) {
                alert("Not enough balance!");
                return;
            }

            balance -= selectedBet;
            balanceAmount.textContent = balance;
            localStorage.setItem("balance", balance);

            bird = { x: 50, y: 150, radius: 15, gravity: 0.1, lift: -3, velocity: 0 };
            pipes = [];
            score = 0;
            passedPipes = 0;
            earnings = 0;
            gameRunning = true;
            earningsDisplay.textContent = "₹ 0";
            playAgainBtn.style.display = "none";
            gameLoop();
        }

        function drawBird() {
            ctx.beginPath();
            ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
            ctx.fillStyle = "yellow";
            ctx.fill();
            ctx.stroke();
        }

        function drawPipes() {
            ctx.fillStyle = "green";
            pipes.forEach(pipe => {
                ctx.fillRect(pipe.x, 0, 50, pipe.top);
                ctx.fillRect(pipe.x, pipe.top + 140, 50, canvas.height - (pipe.top + 140));
            });
        }

        function updatePipes() {
            if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 200) {
                let topHeight = Math.floor(Math.random() * (canvas.height - 140 - 50)) + 30;
                pipes.push({ x: canvas.width, top: topHeight });
            }
            pipes.forEach(pipe => {
                pipe.x -= 1;
                if (pipe.x + 50 < bird.x && !pipe.passed) {
                    pipe.passed = true;
                    passedPipes++;

                    // پائپ پار کرنے پر انعام بڑھاؤ
                    if (passedPipes >= 4) {
                        earnings = selectedBet;  // 4 پائپ پر شرط برابر
                        if (passedPipes > 4) {
                            earnings += Math.floor((passedPipes - 4) * (selectedBet * 0.5));  // 4 کے بعد ہر پائپ پر 1.5x
                        }
                    }

                    earningsDisplay.textContent = "₹ " + earnings;
                }
            });

            if (pipes.length > 0 && pipes[0].x + 50 < 0) {
                pipes.shift();
            }
        }

        function drawScore() {
            ctx.font = "20px Arial";
            ctx.fillStyle = "black";
            ctx.fillText(+ balance, 10, 30);
        }

        function updateBird() {
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;
            if (bird.y + bird.radius >= canvas.height) gameOver();
        }

        function checkCollision() {
            for (let pipe of pipes) {
                if (
                    bird.x + bird.radius > pipe.x &&
                    bird.x - bird.radius < pipe.x + 50 &&
                    (bird.y - bird.radius < pipe.top || bird.y + bird.radius > pipe.top + 140)
                ) {
                    gameOver();
                }
            }
        }

        function gameOver() {
            gameRunning = false;
            playAgainBtn.style.display = "block";

            if (earnings > 0) {
                balance += earnings;
                localStorage.setItem("balance", balance);
                balanceAmount.textContent = balance;
                alert("You won ₹" + earnings + "!");
            } else {
                alert("You lost ₹" + selectedBet);
            }
        }

        function gameLoop() {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBird();
            drawPipes();
            drawScore();
            updateBird();
            updatePipes();
            checkCollision();
            requestAnimationFrame(gameLoop);
        }

        document.addEventListener("keydown", () => bird.velocity = bird.lift);
        document.addEventListener("click", () => bird.velocity = bird.lift);
        playBtn.addEventListener("click", initGame);
        playAgainBtn.addEventListener("click", () => location.reload());

  function sendBalanceToParent() {
    const balance = localStorage.getItem("balance");
    window.parent.postMessage({ balance }, "*");
  }

  // ہر سیکنڈ میں بیلنس بھیجو
  setInterval(sendBalanceToParent, 1000);
    </script> 
 </body>
</html>