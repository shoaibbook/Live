<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet System</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            background: #6a006a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
            font-family: Arial, sans-serif;
        }

        .top-left-container {
            display: flex;
            align-items: center;
            background: gold;
            padding: 8px 15px;
            border-radius: 15px;
        }

        .name {
            color: black;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
        }

        .balance {
            color: white;
            font-size: 14px;
            background: black;
            padding: 5px 10px;
            border-radius: 8px;
            margin-right: 10px;
            font-weight: bold;
        }

        .button {
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }

        .add-money {
            background: cyan;
            color: black;
            margin-right: 10px;
        }

        .withdrawal {
            background: red;
            color: white;
        }

        .game-button {
            background: green;
            color: white;
            margin-left: 10px;
            text-decoration: none;
        }

        .section {
            display: none;
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .section input {
            width: 80%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .section button {
            background: green;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }

        .go-back {
            background: gray !important;
        }

        .records {
            margin-top: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            display: none;
        }

        .record {
            font-size: 14px;
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }

        .upi-address {
            color: black;
            font-weight: bold;
            cursor: pointer;
            background: yellow;
            padding: 5px;
            border-radius: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
  
    <body onfocus="updateBalance()">

    <div class="top-left-container">
        <div class="name"></div>
        <div class="balance" id="balance">₹51.78</div>
        <button class="button add-money" onclick="showSection('addMoneySection')">ADD MONEY</button>
        <button class="button withdrawal" onclick="showSection('withdrawSection')">WITHDRAWAL</button>
        <a href="IPL.html" class="button game-button">IPL</a>
    </div>

    <!-- ADD MONEY SECTION -->
    <div class="section" id="addMoneySection">
        <p class="upi-address" onclick="copyUPI()">8756331066@ybl</p>
        <input type="text" id="utrNumber" placeholder="Enter UTR Number (12 Digits)">
        <input type="number" id="amount" placeholder="Enter Amount">
        <button onclick="addMoney()">ADD</button>
        <button class="go-back" onclick="hideSections()">GO BACK</button>
    </div>

    <!-- WITHDRAW SECTION -->
    <div class="section" id="withdrawSection">
        <input type="text" id="upi" placeholder="Enter UPI ID">
        <input type="number" id="withdrawAmount" placeholder="Enter Amount">
        <button onclick="withdrawMoney()">WITHDRAW</button>
        <button class="go-back" onclick="hideSections()">GO BACK</button>
    </div>

    <!-- ریکارڈز -->
    <div class="records" id="records">
        <p><strong>Transaction History:</strong></p>
    </div>
    
    <iframe src="GAMe.html" 
        width="90%" 
        height="750px" 
        style="margin-top: 30px; border: none; border-radius: 10px;">
</iframe>

    <script>
  let balance = localStorage.getItem("balance") ? parseFloat(localStorage.getItem("balance")) : 51.78;
  let hasAddedMoney = localStorage.getItem("hasAddedMoney") === "true";
  
  function updateBalance() {
    document.getElementById("balance").textContent = `₹${balance.toFixed(2)}`;
    let savedRecords = localStorage.getItem("transactions");
    if (savedRecords) {
      document.getElementById("records").innerHTML = "<p><strong>Transaction History:</strong></p>" + savedRecords;
    }
  }
  
  function showSection(sectionId) {
    document.getElementById(sectionId).style.display = "block";
    document.getElementById("records").style.display = "block";
  }
  
  function hideSections() {
    document.querySelectorAll(".section").forEach(section => {
      section.style.display = "none";
    });
    document.getElementById("records").style.display = "none";
  }
  
  function copyUPI() {
    navigator.clipboard.writeText("8756331066@ybl");
    alert("UPI Address Copied!");
  }
  
  function addMoney() {
    let utr = document.getElementById("utrNumber").value;
    let amount = document.getElementById("amount").value;
    
    if (utr.length === 12 && utr.startsWith(amount.padStart(4, '0')) && utr.endsWith("131")) {
      balance += parseFloat(amount);
      localStorage.setItem("balance", balance.toFixed(2));
      document.getElementById("balance").textContent = `₹${balance.toFixed(2)}`;
      addRecord(utr, amount, "Success");
      hasAddedMoney = true;
      localStorage.setItem("hasAddedMoney", "true");
      sendBalanceToIframe(); // <-- یہ نیا ہے
    } else {
      addRecord(utr, amount, "Processing");
    }
    
    document.getElementById("utrNumber").value = "";
    document.getElementById("amount").value = "";
  }
  
  function addRecord(utr, amount, status) {
    let recordsDiv = document.getElementById("records");
    let newRecord = document.createElement("p");
    newRecord.classList.add("record");
    newRecord.innerHTML = `UTR: ${utr} | Amount: ₹${amount} | Status: ${status}`;
    
    let savedRecords = localStorage.getItem("transactions") || "";
    localStorage.setItem("transactions", savedRecords + newRecord.outerHTML);
    recordsDiv.innerHTML = "<p><strong>Transaction History:</strong></p>" + localStorage.getItem("transactions");
  }
  
  function withdrawMoney() {
    let upi = document.getElementById("upi").value;
    let amount = parseFloat(document.getElementById("withdrawAmount").value);
    let recordsDiv = document.getElementById("records");
    
    if (!hasAddedMoney) {
      alert("پہلے Add Money کریں!");
      return;
    }
    
    if (amount < 11) {
      alert("کم از کم 11 روپے نکال سکتے ہیں!");
      return;
    }
    
    if (amount > balance) {
      alert("اتنا بیلنس دستیاب نہیں ہے!");
      return;
    }
    
    balance -= amount;
    localStorage.setItem("balance", balance.toFixed(2));
    document.getElementById("balance").textContent = `₹${balance.toFixed(2)}`;
    sendBalanceToIframe(); // <-- یہ نیا ہے
    
    let newRecord = document.createElement("p");
    newRecord.innerHTML = `₹${amount} - Processing...`;
    recordsDiv.appendChild(newRecord);
    
    setTimeout(() => {
      newRecord.innerHTML = `₹${amount} - Success ✅`;
    }, 60000);
  }
  
  function sendBalanceToIframe() {
    let gameFrame = document.querySelector("iframe");
    if (gameFrame && gameFrame.contentWindow) {
      gameFrame.contentWindow.postMessage({ type: "updateBalance", balance: balance.toFixed(2) }, "*");
    }
  }
  
  window.onload = updateBalance;
  window.addEventListener("message", (event) => {
    if (event.data.balance !== undefined) {
      const parentBalanceEl = document.getElementById("balance");
      if (parentBalanceEl) {
        parentBalanceEl.textContent = "₹" + event.data.balance;
      }
    }
  });
</script>

</body>
</html>